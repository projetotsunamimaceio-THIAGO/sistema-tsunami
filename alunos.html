<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSUNAMI - Alunos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0a0a0f; color: white; font-family: 'Segoe UI', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 0, 255, 0.1); }
        .btn-fuchsia { border: 1px solid #f5f; background: rgba(255, 0, 255, 0.1); transition: 0.3s; color: white; }
        .btn-fuchsia:hover { background: #f5f; color: black; }
        input { background: rgba(255, 255, 255, 0.05)!important; border: 1px solid rgba(255, 0, 255, 0.2)!important; color: white!important; padding: 12px; border-radius: 8px; outline: none; }
        .loading { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body class="p-8">
    <script>if (sessionStorage.getItem('tsunami_logged') !== 'true') { window.location.href = 'login.html'; }</script>

    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-10">
            <a href="index.html" class="btn-fuchsia px-4 py-2 rounded-lg text-xs font-bold uppercase">Voltar</a>
            <h1 class="text-2xl font-bold text-fuchsia-400 tracking-widest uppercase">Matrícula de Alunos</h1>
        </div>

        <form id="formAluno" class="glass p-6 rounded-xl grid grid-cols-1 gap-4">
            <input type="text" id="nome" placeholder="Nome Completo do Aluno" required>
            <input type="text" id="turma" placeholder="Nome da Turma" required>
            <input type="text" id="matricula" placeholder="Número de Matrícula / Rematrícula" required>
            <input type="date" id="vencimento" required>
            <button type="submit" id="saveBtn" class="btn-fuchsia p-4 rounded-lg font-bold uppercase">Cadastrar Aluno</button>
        </form>
    </div>

    <script>
        const URL_SCRIPT = "https://script.google.com/macros/s/AKfycby-23cMovuAZ0m6JouTueAara4JIYnAQVvRImBzhZWMh26gWhm0aB_KiFpRo2t2CcEQCA/exec";

        // FUNÇÃO CORRIGIDA PARA ENVIAR DADOS
        async function enviarParaPlanilha(dados) {
            const formData = new FormData();
            for (const [chave, valor] of Object.entries(dados)) {
                formData.append(chave, valor);
            }
            
            const resposta = await fetch(URL_SCRIPT, {
                method: 'POST',
                body: formData
            });
            
            const texto = await resposta.text();
            try {
                return JSON.parse(texto);
            } catch (e) {
                return { result: "success" };
            }
        }

        document.getElementById('formAluno').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            btn.innerText = "ENVIANDO...";
            btn.classList.add('loading');

            const dados = {
                action: "alunos",
                nome: document.getElementById('nome').value,
                turma: document.getElementById('turma').value,
                matricula_rematricula: document.getElementById('matricula').value,
                data_vencimento: document.getElementById('vencimento').value
            };

            try {
                const resultado = await enviarParaPlanilha(dados);
                console.log("Resposta:", resultado);
                alert("Aluno cadastrado com sucesso na planilha!");
                e.target.reset();
            } catch (err) {
                console.error("Erro:", err);
                alert("Erro ao enviar. Verifique o console.");
            } finally {
                btn.innerText = "Cadastrar Aluno";
                btn.classList.remove('loading');
            }
        });
    </script>
</body>
</html>